const _0x163b9e=_0x5001;(function(_0xa1e33f,_0x56bd83){const _0x8c2977=_0x5001,_0x5580e9=_0xa1e33f();while(!![]){try{const _0x56fd05=parseInt(_0x8c2977(0xd4))/0x1*(parseInt(_0x8c2977(0x128))/0x2)+-parseInt(_0x8c2977(0x10b))/0x3*(parseInt(_0x8c2977(0x126))/0x4)+parseInt(_0x8c2977(0xe5))/0x5*(-parseInt(_0x8c2977(0xf0))/0x6)+-parseInt(_0x8c2977(0x12f))/0x7*(-parseInt(_0x8c2977(0x112))/0x8)+-parseInt(_0x8c2977(0x108))/0x9*(parseInt(_0x8c2977(0x10c))/0xa)+parseInt(_0x8c2977(0x12a))/0xb*(-parseInt(_0x8c2977(0xe9))/0xc)+parseInt(_0x8c2977(0x10d))/0xd*(parseInt(_0x8c2977(0xea))/0xe);if(_0x56fd05===_0x56bd83)break;else _0x5580e9['push'](_0x5580e9['shift']());}catch(_0x597737){_0x5580e9['push'](_0x5580e9['shift']());}}}(_0x2b00,0x52081));import{connect}from'cloudflare:sockets';let userID=_0x163b9e(0x12d),proxyIP='';if(!isValidUUID(userID))throw new Error(_0x163b9e(0x121));export default{async 'fetch'(_0x2f2dbd,_0x49ec4a,_0x57afa8){const _0x37a90e=_0x163b9e;try{userID=_0x49ec4a[_0x37a90e(0x115)]||userID,proxyIP=_0x49ec4a['PROXYIP']||proxyIP;const _0x3587e7=_0x2f2dbd['headers'][_0x37a90e(0xe0)](_0x37a90e(0xfb));if(!_0x3587e7||_0x3587e7!==_0x37a90e(0x12e)){const _0x26b303=new URL(_0x2f2dbd[_0x37a90e(0xf9)]);switch(_0x26b303['pathname']){case'/':return new Response(JSON[_0x37a90e(0xe6)](_0x2f2dbd['cf']),{'status':0xc8});case'/'+userID:{const _0x47000d=getVLESSConfig(userID,_0x2f2dbd[_0x37a90e(0xe7)][_0x37a90e(0xe0)](_0x37a90e(0xd7)));return new Response(''+_0x47000d,{'status':0xc8,'headers':{'Content-Type':_0x37a90e(0xfe)}});}default:return new Response(_0x37a90e(0x111),{'status':0x194});}}else return await vlessOverWSHandler(_0x2f2dbd);}catch(_0x33f3f0){let _0x34aba0=_0x33f3f0;return new Response(_0x34aba0[_0x37a90e(0xec)]());}}};async function vlessOverWSHandler(_0x25c3db){const _0x2bd9cf=_0x163b9e,_0x42104b=new WebSocketPair(),[_0x1c74c6,_0x5779f3]=Object[_0x2bd9cf(0xfd)](_0x42104b);_0x5779f3[_0x2bd9cf(0xe3)]();let _0x3f5d10='',_0x32533b='';const _0x365bf8=(_0x5e3e41,_0xe4b90b)=>{const _0x1cea9a=_0x2bd9cf;console[_0x1cea9a(0x118)]('['+_0x3f5d10+':'+_0x32533b+']\x20'+_0x5e3e41,_0xe4b90b||'');},_0x43c919=_0x25c3db[_0x2bd9cf(0xe7)][_0x2bd9cf(0xe0)](_0x2bd9cf(0x104))||'',_0x15d904=makeReadableWebSocketStream(_0x5779f3,_0x43c919,_0x365bf8);let _0x308333={'value':null},_0x3bac33=null,_0x3ae233=![];return _0x15d904[_0x2bd9cf(0x109)](new WritableStream({async 'write'(_0x2e64ef,_0x41a0aa){const _0x9f0000=_0x2bd9cf;if(_0x3ae233&&_0x3bac33)return _0x3bac33(_0x2e64ef);if(_0x308333[_0x9f0000(0x116)]){const _0x19b4dd=_0x308333[_0x9f0000(0x116)][_0x9f0000(0xe4)][_0x9f0000(0x12c)]();await _0x19b4dd['write'](_0x2e64ef),_0x19b4dd[_0x9f0000(0x100)]();return;}const {hasError:_0x9ba366,message:_0x1a1a6f,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:_0x33cd76,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:_0x250053}=processVlessHeader(_0x2e64ef,userID);_0x3f5d10=addressRemote,_0x32533b=portRemote+'--'+Math['random']()+'\x20'+(_0x250053?_0x9f0000(0x11b):_0x9f0000(0x125))+'\x20';if(_0x9ba366){throw new Error(_0x1a1a6f);return;}if(_0x250053){if(portRemote===0x35)_0x3ae233=!![];else{throw new Error('UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053');return;}}const _0x368710=new Uint8Array([vlessVersion[0x0],0x0]),_0x16e46b=_0x2e64ef[_0x9f0000(0xff)](_0x33cd76);if(_0x3ae233){const {write:_0x258fbf}=await handleUDPOutBound(_0x5779f3,_0x368710,_0x365bf8);_0x3bac33=_0x258fbf,_0x3bac33(_0x16e46b);return;}handleTCPOutBound(_0x308333,addressRemote,portRemote,_0x16e46b,_0x5779f3,_0x368710,_0x365bf8);},'close'(){const _0x226221=_0x2bd9cf;_0x365bf8(_0x226221(0x10a));},'abort'(_0x53f573){const _0x37eebb=_0x2bd9cf;_0x365bf8(_0x37eebb(0xe8),JSON[_0x37eebb(0xe6)](_0x53f573));}}))[_0x2bd9cf(0x10e)](_0x57c06c=>{const _0x31bb46=_0x2bd9cf;_0x365bf8(_0x31bb46(0xf7),_0x57c06c);}),new Response(null,{'status':0x65,'webSocket':_0x1c74c6});}function _0x2b00(){const _0x336b60=['https://1.1.1.1/dns-query','get','webSocketServer\x20has\x20error','write','accept','writable','55GdcUMq','stringify','headers','readableWebSocketStream\x20is\x20abort','1284288SMtuSt','4172042beWkhO','\x0a################################################################\x0av2ray\x0a---------------------------------------------------------------\x0a','toString','invild\x20\x20addressType\x20is\x20','vless','getUint16','65460YRohkI','invalid\x20user','send','finally','error','command\x20','from','readableWebSocketStream\x20pipeTo\x20error','connected\x20to\x20','url','dns\x20udp\x20has\x20error','Upgrade','replace','values','text/plain;charset=utf-8','slice','releaseLock','?encryption=none&security=tls&sni=','invalid\x20data','addressValue\x20is\x20empty,\x20addressType\x20is\x20','sec-websocket-protocol','byteLength','addEventListener','decode','45naDvgi','pipeTo','readableWebSocketStream\x20is\x20close','3hYTsqq','125640NYYHrj','52WsFRJQ','catch','readable','remoteSocketToWS\x20has\x20exception\x20','Not\x20found','256YLqAQv','doh\x20success\x20and\x20dns\x20message\x20length\x20is\x20','&path=%2F%3Fed%3D2048#','UUID','value','Stringified\x20UUID\x20is\x20invalid','log','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','retry\x20tcpSocket\x20closed\x20error','udp\x20','data',':443','\x0a\x20\x20client-fingerprint:\x20chrome\x0a\x20\x20ws-opts:\x0a\x20\x20\x20\x20path:\x20\x22/?ed=2048\x22\x0a\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20host:\x20','join','readyState','uuid\x20is\x20not\x20valid','test','stack','\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux','tcp\x20','765068WXANgC','remoteConnection!.readable\x20abort','1452MFimdM','enqueue','55ftLvsA','&fp=randomized&type=ws&host=','getWriter','d342d11e-d424-4583-b36e-524ab1f0afa4','websocket','8939bjfDzd','remoteConnection!.readable\x20is\x20close\x20with\x20hasIncomingData\x20is\x20','17NZmCAr','buffer','\x0a\x20\x20port:\x20443\x0a\x20\x20uuid:\x20','Host','arrayBuffer','://','safeCloseWebSocket\x20error','message','push','POST','close'];_0x2b00=function(){return _0x336b60;};return _0x2b00();}async function handleTCPOutBound(_0x297008,_0x40e427,_0x147ae5,_0x4f0a84,_0x1923ed,_0x258753,_0x3dd726){async function _0x2eba82(_0x22831f,_0x238c34){const _0x5792ff=_0x5001,_0x1e2bda=connect({'hostname':_0x22831f,'port':_0x238c34});_0x297008['value']=_0x1e2bda,_0x3dd726(_0x5792ff(0xf8)+_0x22831f+':'+_0x238c34);const _0x118929=_0x1e2bda[_0x5792ff(0xe4)]['getWriter']();return await _0x118929[_0x5792ff(0xe2)](_0x4f0a84),_0x118929[_0x5792ff(0x100)](),_0x1e2bda;}async function _0x9134b7(){const _0x42d809=_0x5001,_0x28ffac=await _0x2eba82(proxyIP||_0x40e427,_0x147ae5);_0x28ffac['closed'][_0x42d809(0x10e)](_0x34bdd9=>{const _0x15becf=_0x42d809;console['log'](_0x15becf(0x11a),_0x34bdd9);})[_0x42d809(0xf3)](()=>{safeCloseWebSocket(_0x1923ed);}),remoteSocketToWS(_0x28ffac,_0x1923ed,_0x258753,null,_0x3dd726);}const _0x1e7882=await _0x2eba82(_0x40e427,_0x147ae5);remoteSocketToWS(_0x1e7882,_0x1923ed,_0x258753,_0x9134b7,_0x3dd726);}function makeReadableWebSocketStream(_0x41c9c9,_0x43d3f8,_0x20eb8e){let _0x5ab6d7=![];const _0x3cf30d=new ReadableStream({'start'(_0x4a42d0){const _0x57cfcb=_0x5001;_0x41c9c9[_0x57cfcb(0x106)](_0x57cfcb(0xdb),_0x2f8aef=>{const _0x12a76b=_0x57cfcb;if(_0x5ab6d7)return;const _0x23d015=_0x2f8aef[_0x12a76b(0x11c)];_0x4a42d0[_0x12a76b(0x129)](_0x23d015);}),_0x41c9c9[_0x57cfcb(0x106)](_0x57cfcb(0xde),()=>{const _0x4d4891=_0x57cfcb;safeCloseWebSocket(_0x41c9c9);if(_0x5ab6d7)return;_0x4a42d0[_0x4d4891(0xde)]();}),_0x41c9c9[_0x57cfcb(0x106)](_0x57cfcb(0xf4),_0x14de46=>{const _0x34eb44=_0x57cfcb;_0x20eb8e(_0x34eb44(0xe1)),_0x4a42d0[_0x34eb44(0xf4)](_0x14de46);});const {earlyData:_0x1e0b29,error:_0x2a50be}=base64ToArrayBuffer(_0x43d3f8);if(_0x2a50be)_0x4a42d0['error'](_0x2a50be);else _0x1e0b29&&_0x4a42d0[_0x57cfcb(0x129)](_0x1e0b29);},'pull'(_0x4a13a9){},'cancel'(_0x32e8fb){const _0x547842=_0x5001;if(_0x5ab6d7)return;_0x20eb8e(_0x547842(0x119)+_0x32e8fb),_0x5ab6d7=!![],safeCloseWebSocket(_0x41c9c9);}});return _0x3cf30d;}function processVlessHeader(_0x45b44c,_0x338948){const _0x283aad=_0x163b9e;if(_0x45b44c[_0x283aad(0x105)]<0x18)return{'hasError':!![],'message':_0x283aad(0x102)};const _0x2ecf0e=new Uint8Array(_0x45b44c[_0x283aad(0xff)](0x0,0x1));let _0x4287a3=![],_0x13e7ba=![];stringify(new Uint8Array(_0x45b44c['slice'](0x1,0x11)))===_0x338948&&(_0x4287a3=!![]);if(!_0x4287a3)return{'hasError':!![],'message':_0x283aad(0xf1)};const _0x46b7d6=new Uint8Array(_0x45b44c[_0x283aad(0xff)](0x11,0x12))[0x0],_0x328067=new Uint8Array(_0x45b44c[_0x283aad(0xff)](0x12+_0x46b7d6,0x12+_0x46b7d6+0x1))[0x0];if(_0x328067===0x1){}else{if(_0x328067===0x2)_0x13e7ba=!![];else return{'hasError':!![],'message':_0x283aad(0xf5)+_0x328067+_0x283aad(0x124)};}const _0x3ad3fa=0x12+_0x46b7d6+0x1,_0x451ae8=_0x45b44c[_0x283aad(0xff)](_0x3ad3fa,_0x3ad3fa+0x2),_0x2d2ccf=new DataView(_0x451ae8)['getUint16'](0x0);let _0x542830=_0x3ad3fa+0x2;const _0x3f8d27=new Uint8Array(_0x45b44c[_0x283aad(0xff)](_0x542830,_0x542830+0x1)),_0x3c7028=_0x3f8d27[0x0];let _0x144824=0x0,_0x1a9dcf=_0x542830+0x1,_0x501fe1='';switch(_0x3c7028){case 0x1:_0x144824=0x4,_0x501fe1=new Uint8Array(_0x45b44c[_0x283aad(0xff)](_0x1a9dcf,_0x1a9dcf+_0x144824))['join']('.');break;case 0x2:_0x144824=new Uint8Array(_0x45b44c[_0x283aad(0xff)](_0x1a9dcf,_0x1a9dcf+0x1))[0x0],_0x1a9dcf+=0x1,_0x501fe1=new TextDecoder()[_0x283aad(0x107)](_0x45b44c[_0x283aad(0xff)](_0x1a9dcf,_0x1a9dcf+_0x144824));break;case 0x3:_0x144824=0x10;const _0x429625=new DataView(_0x45b44c[_0x283aad(0xff)](_0x1a9dcf,_0x1a9dcf+_0x144824)),_0x15f0bd=[];for(let _0x2a26b8=0x0;_0x2a26b8<0x8;_0x2a26b8++){_0x15f0bd[_0x283aad(0xdc)](_0x429625[_0x283aad(0xef)](_0x2a26b8*0x2)['toString'](0x10));}_0x501fe1=_0x15f0bd[_0x283aad(0x11f)](':');break;default:return{'hasError':!![],'message':_0x283aad(0xed)+_0x3c7028};}if(!_0x501fe1)return{'hasError':!![],'message':_0x283aad(0x103)+_0x3c7028};return{'hasError':![],'addressRemote':_0x501fe1,'addressType':_0x3c7028,'portRemote':_0x2d2ccf,'rawDataIndex':_0x1a9dcf+_0x144824,'vlessVersion':_0x2ecf0e,'isUDP':_0x13e7ba};}async function remoteSocketToWS(_0x1079ef,_0x1181ac,_0x1ccfaf,_0x396df4,_0x34c4f0){const _0x6355fc=_0x163b9e;let _0x1ce64a=0x0,_0x4faae6=[],_0x31db02=_0x1ccfaf,_0x7f76d2=![];await _0x1079ef[_0x6355fc(0x10f)][_0x6355fc(0x109)](new WritableStream({'start'(){},async 'write'(_0x1272af,_0xbbb4ee){const _0x58a3d3=_0x6355fc;_0x7f76d2=!![],_0x1181ac['readyState']!==WS_READY_STATE_OPEN&&_0xbbb4ee[_0x58a3d3(0xf4)]('webSocket.readyState\x20is\x20not\x20open,\x20maybe\x20close'),_0x31db02?(_0x1181ac[_0x58a3d3(0xf2)](await new Blob([_0x31db02,_0x1272af])['arrayBuffer']()),_0x31db02=null):_0x1181ac[_0x58a3d3(0xf2)](_0x1272af);},'close'(){const _0x270494=_0x6355fc;_0x34c4f0(_0x270494(0x130)+_0x7f76d2);},'abort'(_0x2b2307){const _0x4314ad=_0x6355fc;console['error'](_0x4314ad(0x127),_0x2b2307);}}))[_0x6355fc(0x10e)](_0x2be8ed=>{const _0x41c27f=_0x6355fc;console[_0x41c27f(0xf4)](_0x41c27f(0x110),_0x2be8ed[_0x41c27f(0x123)]||_0x2be8ed),safeCloseWebSocket(_0x1181ac);}),_0x7f76d2===![]&&_0x396df4&&(_0x34c4f0('retry'),_0x396df4());}function base64ToArrayBuffer(_0x898caa){const _0x1dc67f=_0x163b9e;if(!_0x898caa)return{'error':null};try{_0x898caa=_0x898caa[_0x1dc67f(0xfc)](/-/g,'+')['replace'](/_/g,'/');const _0x4dfdbf=atob(_0x898caa),_0x32b46f=Uint8Array[_0x1dc67f(0xf6)](_0x4dfdbf,_0xf58761=>_0xf58761['charCodeAt'](0x0));return{'earlyData':_0x32b46f[_0x1dc67f(0xd5)],'error':null};}catch(_0x5ad591){return{'error':_0x5ad591};}}function _0x5001(_0x2dba3d,_0x10ba99){const _0x2b00b7=_0x2b00();return _0x5001=function(_0x50012d,_0x7a4d9){_0x50012d=_0x50012d-0xd4;let _0x1ffd73=_0x2b00b7[_0x50012d];return _0x1ffd73;},_0x5001(_0x2dba3d,_0x10ba99);}function isValidUUID(_0x2e3153){const _0xcd254=_0x163b9e,_0x4becac=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return _0x4becac[_0xcd254(0x122)](_0x2e3153);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x32eaed){const _0x56d250=_0x163b9e;try{(_0x32eaed['readyState']===WS_READY_STATE_OPEN||_0x32eaed['readyState']===WS_READY_STATE_CLOSING)&&_0x32eaed[_0x56d250(0xde)]();}catch(_0x39b6fb){console[_0x56d250(0xf4)](_0x56d250(0xda),_0x39b6fb);}}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex[_0x163b9e(0xdc)]((i+0x100)[_0x163b9e(0xec)](0x10)[_0x163b9e(0xff)](0x1));}function unsafeStringify(_0x3d97cb,_0x1daaef=0x0){return(byteToHex[_0x3d97cb[_0x1daaef+0x0]]+byteToHex[_0x3d97cb[_0x1daaef+0x1]]+byteToHex[_0x3d97cb[_0x1daaef+0x2]]+byteToHex[_0x3d97cb[_0x1daaef+0x3]]+'-'+byteToHex[_0x3d97cb[_0x1daaef+0x4]]+byteToHex[_0x3d97cb[_0x1daaef+0x5]]+'-'+byteToHex[_0x3d97cb[_0x1daaef+0x6]]+byteToHex[_0x3d97cb[_0x1daaef+0x7]]+'-'+byteToHex[_0x3d97cb[_0x1daaef+0x8]]+byteToHex[_0x3d97cb[_0x1daaef+0x9]]+'-'+byteToHex[_0x3d97cb[_0x1daaef+0xa]]+byteToHex[_0x3d97cb[_0x1daaef+0xb]]+byteToHex[_0x3d97cb[_0x1daaef+0xc]]+byteToHex[_0x3d97cb[_0x1daaef+0xd]]+byteToHex[_0x3d97cb[_0x1daaef+0xe]]+byteToHex[_0x3d97cb[_0x1daaef+0xf]])['toLowerCase']();}function stringify(_0x4a611a,_0x502c91=0x0){const _0xcd4094=_0x163b9e,_0xda73a1=unsafeStringify(_0x4a611a,_0x502c91);if(!isValidUUID(_0xda73a1))throw TypeError(_0xcd4094(0x117));return _0xda73a1;}async function handleUDPOutBound(_0x498f60,_0x201ef8,_0x7c4de6){const _0x20f6d8=_0x163b9e;let _0x1c6723=![];const _0x1f3d6c=new TransformStream({'start'(_0x188e3e){},'transform'(_0x10ff3c,_0x4c2bca){const _0xfb9bc3=_0x5001;for(let _0x518aae=0x0;_0x518aae<_0x10ff3c[_0xfb9bc3(0x105)];){const _0x471594=_0x10ff3c['slice'](_0x518aae,_0x518aae+0x2),_0xd90cc4=new DataView(_0x471594)['getUint16'](0x0),_0x4a2840=new Uint8Array(_0x10ff3c[_0xfb9bc3(0xff)](_0x518aae+0x2,_0x518aae+0x2+_0xd90cc4));_0x518aae=_0x518aae+0x2+_0xd90cc4,_0x4c2bca[_0xfb9bc3(0x129)](_0x4a2840);}},'flush'(_0x2ca057){}});_0x1f3d6c['readable'][_0x20f6d8(0x109)](new WritableStream({async 'write'(_0x3a582b){const _0x8e7d28=_0x20f6d8,_0x3ce302=await fetch(_0x8e7d28(0xdf),{'method':_0x8e7d28(0xdd),'headers':{'content-type':'application/dns-message'},'body':_0x3a582b}),_0x20037c=await _0x3ce302['arrayBuffer'](),_0x5d5a0b=_0x20037c['byteLength'],_0x1e55b1=new Uint8Array([_0x5d5a0b>>0x8&0xff,_0x5d5a0b&0xff]);_0x498f60[_0x8e7d28(0x120)]===WS_READY_STATE_OPEN&&(_0x7c4de6(_0x8e7d28(0x113)+_0x5d5a0b),_0x1c6723?_0x498f60[_0x8e7d28(0xf2)](await new Blob([_0x1e55b1,_0x20037c])[_0x8e7d28(0xd8)]()):(_0x498f60[_0x8e7d28(0xf2)](await new Blob([_0x201ef8,_0x1e55b1,_0x20037c])[_0x8e7d28(0xd8)]()),_0x1c6723=!![]));}}))[_0x20f6d8(0x10e)](_0x8149e7=>{const _0x45c29b=_0x20f6d8;_0x7c4de6(_0x45c29b(0xfa)+_0x8149e7);});const _0x4ecdd4=_0x1f3d6c[_0x20f6d8(0xe4)][_0x20f6d8(0x12c)]();return{'write'(_0x5c7b5e){const _0x5d86ab=_0x20f6d8;_0x4ecdd4[_0x5d86ab(0xe2)](_0x5c7b5e);}};}function getVLESSConfig(_0x4205ff,_0x56dda2){const _0x5ae358=_0x163b9e,_0x2270da=_0x5ae358(0xee),_0x114696=''+_0x2270da+(_0x5ae358(0xd9)+_0x4205ff+'@'+_0x56dda2+_0x5ae358(0x11d))+(_0x5ae358(0x101)+_0x56dda2+_0x5ae358(0x12b)+_0x56dda2+_0x5ae358(0x114)+_0x56dda2);return _0x5ae358(0xeb)+_0x114696+'\x0a---------------------------------------------------------------\x0a################################################################\x0aclash-meta\x0a---------------------------------------------------------------\x0a-\x20type:\x20vless\x0a\x20\x20name:\x20'+_0x56dda2+'\x0a\x20\x20server:\x20'+_0x56dda2+_0x5ae358(0xd6)+_0x4205ff+'\x0a\x20\x20network:\x20ws\x0a\x20\x20tls:\x20true\x0a\x20\x20udp:\x20false\x0a\x20\x20sni:\x20'+_0x56dda2+_0x5ae358(0x11e)+_0x56dda2+'\x0a---------------------------------------------------------------\x0a################################################################\x0a';}
